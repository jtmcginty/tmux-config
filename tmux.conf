# Remap prefix to Ctrl-a
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Ergonomic splits (no shift needed)
bind s split-window -h # horizontal split
bind v split-window -v # vertical split
unbind '"'
unbind '%'

# Vim-style pane navigation with Option key (no prefix)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Vim-style pane navigation with Option key (no prefix)
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# Previous/next window with Option + arrow keys
bind-key -n M-Left previous-window
bind-key -n M-Right next-window

# Mobile-friendly: PageUp cycles windows, PageDown cycles sessions (no prefix needed)
bind-key -n PageUp next-window
bind-key -n PageDown switch-client -n

# Previous/next session with Option + brackets
bind-key -n M-[ switch-client -p
bind-key -n M-] switch-client -n

# New session with prefix + N
bind-key N command-prompt -p "New session name:" -I "" "new-session -s '%%'"

# Kill current session with prefix + K (switches to another session if available)
bind-key K confirm-before -p "Kill session #S? (y/n)" "run-shell 'tmux switch-client -n \\\; kill-session -t \"#S\"'"

# Enable mouse support
set -g mouse on

# Start windows and panes at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Reload config
bind r source-file ~/.tmux.conf \; display "Config Reloaded!"

# Don't rename windows automatically
set-option -g allow-rename off

# Empty prompt when renaming windows (no backspacing needed)
bind-key , command-prompt -I "" "rename-window '%%'"

# Empty prompt when renaming sessions (no backspacing needed)
bind-key '$' command-prompt -I "" "rename-session '%%'"

# Increase scrollback buffer
set -g history-limit 10000

# Increase status bar refresh rate
set -g status-interval 1

# 256 color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g focus-events on

# Vim-style copy mode
setw -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ============================================================================
# Rose Pine Theme (Custom Layout)
# ============================================================================

# Rose Pine Main colors
set -g status-style bg=#191724,fg=#e0def4
set -g status-left-style bg=#191724,fg=#e0def4
set -g status-right-style bg=#191724,fg=#e0def4

# Window status colors
set -g window-status-style bg=#191724,fg=#6e6a86
set -g window-status-current-style bg=#89b4fa,fg=#191724,bold

# Pane border colors
set -g pane-border-style fg=#6e6a86
set -g pane-active-border-style fg=#89b4fa

# Message colors
set -g message-style bg=#89b4fa,fg=#191724
set -g message-command-style bg=#89b4fa,fg=#191724

# Status bar content
set -g status-left-length 100
set -g status-right-length 100
set -g status-left "#[fg=#191724,bg=#89b4fa,bold] #S #[fg=#89b4fa,bg=#191724]#[fg=#e0def4] "
set -g status-right "#{session_dots} #[fg=#6e6a86]| #(~/tmux-config/scripts/status-responsive.sh)"

# Window status format (Z indicator shows when zoomed)
set -g window-status-format " #I:#W#{?window_zoomed_flag, üîç,} "
set -g window-status-current-format "#[fg=#191724,bg=#89b4fa,bold] #I:#W#{?window_zoomed_flag, üîç,} "

# Left-align the window list
set -g status-justify left

# ============================================================================
# Plugins
# ============================================================================

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Save/restore tmux sessions (survives restarts)
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Status bar enhancements
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'xamut/tmux-weather'
set -g @plugin 'olimorris/tmux-pomodoro-plus'
set -g @plugin 'jtmcginty/tmux-session-dots'
set -g @plugin 'jtmcginty/tmux-session-dots'

# Weather settings
set-option -g @tmux-weather-units "u"
set-option -g @tmux-weather-format "%c+%f+üí®%w+üíß%h+üåßÔ∏è%p"
set-option -g @tmux-weather-interval "15"

# Pomodoro settings
unbind p
set -g @pomodoro_toggle 'p'
set -g @pomodoro_mins 25
set -g @pomodoro_break_mins 5
set -g @pomodoro_on "üçÖ "
set -g @pomodoro_complete "‚úÖ "
set -g @pomodoro_pause "‚è∏ "

# Auto-save every 15 minutes
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Restore nvim sessions (if you use vim-obsession)
set -g @resurrect-strategy-nvim 'session'

# ============================================================================
# Fix for Powerlevel10k prompt after tmux-resurrect
# ============================================================================

set -g default-shell /bin/zsh
set -g default-command /bin/zsh

# Fix P10k prompt after resurrect restores layout
set -g @resurrect-hook-post-restore-pane-processes 'tmux send-keys -t #{pane_id} C-l'

# Initialize TPM (keep this at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
